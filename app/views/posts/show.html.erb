<div class="title">A post</div>
<%- if @post.user.nil? -%>
<div class="show">
  <div class="head_removed">[ removed ]</div>
  <div class="back"><%= link_to "Back to all the posts", posts_path %></div>
</div>
<%- elsif @post.user.id == session[:login] -%>
<%= form_for :post, url: @post, method: :patch, html: {class: :show} do |f| %>
  <div class="head_title" data-title="<%= @post.comment_threads.first.title %>">
    <%= link_to @post.comment_threads.first.title, @post.item, class: :hide if @post.kind == "project" %>
    <div class="head_rename">
<%=     fields_for :comment_thread do |t| %>
      <%= t.text_field :title %>
<%-     end -%>
<%=     f.submit "Rename" %>
    </div>
  </div>
  <div class="head_subhead">
    <%= @post.kind %> by <%= link_to @post.user.handle, @post.user %> - 
    <span class="action remove">don't remove</span> - 
    <span class="action rename">don't rename</span>
  </div>
  <div class="head_remove">
    <span>Are you <b>sure</b>?</span>
    <%= f.submit "Remove", class: :hide %>
  </div>
  <div class="back"><%= link_to "Back to all the posts", posts_path %></div>
<%-   end -%>
<%- else -%>
<div class="show">
  <div class="head_title"><%= link_to(@post.comment_threads.first.title, @post.item) if @post.kind == "project" %></div>
  <div class="head_subhead"><%= @post.kind + " by " + @post.user.handle %></div>
  <div class="back"><%= link_to "Back to all the posts", posts_path %></div>
</div>
<%- end -%>
<%= form_for :comment, url: comments_path, method: :create do |f| %>
<%=   fields_for :comment_thread do |t| %>
  <%= t.hidden_field :id, value: @post.comment_threads.first.id %>
<%-   end -%>
  <%= f.hidden_field :body %>
  <table class="comments">
    <caption>
     <div>Append a comment</div>
     <%= render "comments/markdown_tip" %>
     <textarea></textarea>
     <%= f.submit "Discuss" %>
    </caption> 
<%-   @comments.each do |comment|
        show = comment.user.id == session[:login] -%>
    <tr id="comment_<%= comment.id %>">
      <td class="commenter">
        <%= link_to comment.user.handle, comment.user %>
<%-     if show -%>
        <span class="action edit">don't edit</span> - 
        <span class="action remove">don't remove</span>
        <span class="comment_remove">
          <span>Are you <b>sure</b>?</span>
          <%= f.submit "Remove", class: :invisible %>
        </span>
        <%= f.submit "Update" %>
<%-     end -%>
      </td>
      <td class="comment<%= ' hide' if show -%>" data-body="<%= comment.body %>">
        <div><%= markdown comment.body %>
          <div class="timestamp"><%= comment.created_at.to_formatted_s(:long) %></div>
        </div>
      </td>
      <%- if show -%><td class="comment_edit"><textarea></textarea></td><%- end -%>
    </tr>
<%-   end -%>
  </table>
<%- end -%>
